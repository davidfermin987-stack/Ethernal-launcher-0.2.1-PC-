<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ethernal Client 0.1</title>
  <link rel="icon" href="ðŸ”¥" />
  <script src="https://alcdn.msauth.net/browser/2.37.0/js/msal-browser.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('fondo_default.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      text-align: center;
      overflow: hidden;
      transition: background 1s ease-in-out;
    }

    .fade { opacity: 0; transition: opacity 1s ease-in-out; }
    .fade.show { opacity: 1; }

    #logo {
      width: 500px;
      margin-top: 60px;
      filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.4));
      transition: opacity 1s ease-in-out;
    }

    #event-logo {
      display: none;
      width: 400px;
      margin: 80px auto 20px;
      transition: opacity 1s ease-in-out;
    }

    .event-panel {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 120px;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(6px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      padding-top: 30px;
      box-shadow: 2px 0 10px rgba(0,0,0,0.4);
    }

    .event-selector {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .event-icon {
      width: 80px;
      height: 80px;
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .event-icon:hover,
    .event-icon.active {
      background-color: rgba(0, 0, 0, 0.6);
      border: 2px solid #00bfff;
      transform: scale(1.1);
    }

    #addInstanceBtn {
      width: 70px;
      height: 70px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 50%;
      border: 2px solid #00bfff;
      color: white;
      font-size: 40px;
      cursor: pointer;
      line-height: 70px;
      text-align: center;
      margin-top: 30px;
      transition: all 0.3s ease;
    }

    #addInstanceBtn:hover {
      background: rgba(0, 0, 0, 0.6);
      transform: scale(1.1);
    }

    #playButton {
      background-color: rgba(0, 0, 60, 0.7);
      border: none;
      padding: 15px 80px;
      font-size: 22px;
      color: white;
      border-radius: 15px;
      cursor: pointer;
      margin-top: 40px;
      transition: all 0.3s ease;
      position: fixed;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
    }

    #playButton:hover {
      background-color: rgba(0, 0, 90, 0.8);
      transform: translateX(-50%) scale(1.05);
    }

    #userIcon {
      position: fixed;
      bottom: 20px;
      left: 25px;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #00bfff;
    }

    #userIcon:hover {
      transform: scale(1.1);
      border-color: white;
    }

    #adminPanel {
      position: fixed;
      top: 0;
      right: 0;
      height: 100vh;
      width: 220px;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(6px);
      padding: 20px;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.4);
      display: none;
      flex-direction: column;
      color: white;
      text-align: left;
    }

    #adminPanel h3 { text-align: center; margin-bottom: 20px; }

    .toggle {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      background: rgba(255, 255, 255, 0.1);
      padding: 8px;
      border-radius: 10px;
    }

    .toggle button {
      background: rgba(0, 0, 100, 0.6);
      border: none;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      padding: 5px 10px;
      transition: all 0.3s ease;
    }

    .toggle button:hover { background: rgba(0, 0, 150, 0.8); }

    /* Panel de instancias */
    #instancesPanel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      width: 70%;
      height: 70%;
      border-radius: 20px;
      padding: 20px;
      display: none;
      flex-direction: column;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }

    #instancesPanel h2 {
      margin-top: 0;
      text-align: center;
    }

    #closeInstances {
      position: absolute;
      top: 15px;
      right: 20px;
      background: none;
      color: white;
      border: none;
      font-size: 30px;
      cursor: pointer;
    }

    .instance-gallery {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 50px;
    }

    .instance-card {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 15px;
      cursor: pointer;
      width: 180px;
      transition: all 0.3s ease;
    }

    .instance-card:hover {
      background: rgba(255,255,255,0.2);
      transform: scale(1.05);
    }

    .instance-card img {
      width: 100%;
      border-radius: 10px;
    }

    /* Panel de confirmaciÃ³n */
    #confirmPanel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      padding: 40px;
      border-radius: 15px;
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .confirm-buttons {
      display: flex;
      gap: 20px;
    }

    .confirm-buttons button {
      padding: 10px 25px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #acceptBtn {
      background: green;
      color: white;
    }

    #cancelBtn {
      background: gray;
      color: white;
    }
  </style>
</head>
<body>
  <img id="logo" src="logo_principal.png" alt="Ethernal Client" />
  <img id="event-logo" src="" alt="Evento" />

  <div class="event-panel">
    <div class="event-selector" id="eventSelector"></div>
    <div id="addInstanceBtn">+</div>
  </div>

  <button id="playButton">JUGAR</button>
  <img id="userIcon" src="usuario.png" alt="Usuario" />

  <div id="adminPanel">
    <h3>Panel Admin</h3>
    <div class="toggle">
      <span>Pesadilla</span>
      <button id="togglePesadilla">ON</button>
    </div>
    <div class="toggle">
      <span>Build</span>
      <button id="toggleBuild">ON</button>
    </div>
    <div class="toggle">
      <span>InfecciÃ³n</span>
      <button id="toggleInfeccion">ON</button>
    </div>
  </div>

  <!-- Panel de instancias -->
  <div id="instancesPanel">
    <button id="closeInstances">âœ–</button>
    <h2>Instancias</h2>
    <div class="instance-gallery">
      <div class="instance-card" data-id="pesadilla">
        <img src="pesadilla.png" alt="Pesadilla">
        <p>Pesadilla Hardcore</p>
      </div>
      <div class="instance-card" data-id="build">
        <img src="build.png" alt="Build">
        <p>Build Ethernal Battle</p>
      </div>
      <div class="instance-card" data-id="infeccion">
        <img src="infeccion.png" alt="InfecciÃ³n">
        <p>InfecciÃ³n Hardcore</p>
      </div>
    </div>
  </div>

  <!-- Panel de confirmaciÃ³n -->
  <div id="confirmPanel">
    <p>Â¿Quieres aÃ±adir esta instancia al panel de eventos?</p>
    <div class="confirm-buttons">
      <button id="acceptBtn">Aceptar</button>
      <button id="cancelBtn">Cancelar</button>
    </div>
  </div>

  <script>
    const events = {
      pesadilla: { fondo: 'fondo_pesadilla.jpg', logo: 'logo_pesadilla.png', link: 'minecraft://connect/?serverUrl=na81.aternos.me&serverPort=60240' },
      build: { fondo: 'fondo_build.jpg', logo: 'logo_build.png', link: 'minecraft://connect/?serverUrl=na81.aternos.me&serverPort=60240' },
      infeccion: { fondo: 'fondo_infeccion.jpg', logo: 'logo_infeccion.png', link: 'minecraft://connect/?serverUrl=na81.aternos.me&serverPort=60240' }
    };

    let selectedEvent = null;
    let userLoggedIn = false;
    let isAdmin = false;
    const adminEmails = ["admin1@gmail.com", "admin2@gmail.com", "davidethernal@gmail.com"];
    let eventStatus = JSON.parse(localStorage.getItem("eventStatus")) || { pesadilla: true, build: true, infeccion: true };

    const eventSelector = document.getElementById('eventSelector');
    const instancesPanel = document.getElementById('instancesPanel');
    const confirmPanel = document.getElementById('confirmPanel');
    let selectedToAdd = null;

    function updateAdminButtons() {
      for (const e in eventStatus) {
        const btn = document.getElementById("toggle" + e.charAt(0).toUpperCase() + e.slice(1));
        if (!btn) continue;
        btn.textContent = eventStatus[e] ? "ON" : "OFF";
        btn.style.background = eventStatus[e] ? "rgba(0,0,100,0.6)" : "rgba(100,0,0,0.6)";
      }
    }

    function addEventIcon(id) {
      if (document.getElementById(id)) return;
      const img = document.createElement('img');
      img.src = id + '.png';
      img.id = id;
      img.className = 'event-icon';
      img.alt = id;
      img.addEventListener('click', () => selectEvent(id));
      eventSelector.appendChild(img);
    }

    function selectEvent(id) {
      document.querySelectorAll('.event-icon').forEach(i => i.classList.remove('active'));
      const icon = document.getElementById(id);
      icon.classList.add('active');
      const event = events[id];
      selectedEvent = event;
      document.body.classList.add('fade');
      setTimeout(() => {
        document.body.style.backgroundImage = url('${event.fondo}');
        document.body.classList.remove('fade');
      }, 500);
      document.getElementById('logo').style.display = 'none';
      const eventLogo = document.getElementById('event-logo');
      eventLogo.src = event.logo;
      eventLogo.style.display = 'block';
      eventLogo.classList.add('show');
    }

    document.getElementById('addInstanceBtn').onclick = () => {
      instancesPanel.style.display = 'flex';
    };
    document.getElementById('closeInstances').onclick = () => {
      instancesPanel.style.display = 'none';
    };

    document.querySelectorAll('.instance-card').forEach(card => {
      card.onclick = () => {
        selectedToAdd = card.dataset.id;
        confirmPanel.style.display = 'flex';
      };
    });

    document.getElementById('acceptBtn').onclick = () => {
      addEventIcon(selectedToAdd);
      confirmPanel.style.display = 'none';
      instancesPanel.style.display = 'none';
    };

    document.getElementById('cancelBtn').onclick = () => {
      confirmPanel.style.display = 'none';
    };

    document.getElementById('playButton').addEventListener('click', () => {
      if (!userLoggedIn) return alert('âš ï¸ Debes iniciar sesiÃ³n con Microsoft antes de jugar.');
      if (!selectedEvent) return alert('Selecciona un evento primero.');
      const id = Object.keys(events).find(key => events[key] === selectedEvent);
      if (!eventStatus[id]) return alert('ðŸš« Este evento estÃ¡ deshabilitado por un administrador.');
      window.location.href = selectedEvent.link;
    });

    updateAdminButtons();

  const instancePanel = document.getElementById("instancePanel");
  const confirmPanel = document.getElementById("confirmPanel");
  const addButton = document.getElementById("addInstance");
  const closeButton = document.getElementById("closeInstance");
  const cancelAdd = document.getElementById("cancelAdd");
  const acceptAdd = document.getElementById("acceptAdd");
  let selectedInstance = null;

  // ðŸ”¹ Recuperar instancias guardadas al cargar la pÃ¡gina
  window.addEventListener("DOMContentLoaded", () => {
    const savedInstances = JSON.parse(localStorage.getItem("userInstances")) || [];
    savedInstances.forEach(inst => addInstanceToPanel(inst.name, inst.img, false));
  });

  // ðŸ”¹ Abrir panel de instancias
  addButton.addEventListener("click", () => {
    instancePanel.style.display = "flex";
  });

  // ðŸ”¹ Cerrar panel
  closeButton.addEventListener("click", () => {
    instancePanel.style.display = "none";
  });

  // ðŸ”¹ Click en una instancia (mostrar confirmaciÃ³n)
  document.querySelectorAll(".instance-card").forEach(card => {
    card.addEventListener("click", () => {
      selectedInstance = {
        name: card.getAttribute("data-name"),
        img: card.getAttribute("data-img")
      };
      confirmPanel.style.display = "flex";
      instancePanel.style.display = "none";
    });
  });

  // ðŸ”¹ Cancelar agregar
  cancelAdd.addEventListener("click", () => {
    confirmPanel.style.display = "none";
    instancePanel.style.display = "flex";
  });

  // ðŸ”¹ Aceptar y aÃ±adir instancia al panel lateral
  acceptAdd.addEventListener("click", () => {
    confirmPanel.style.display = "none";
    if (selectedInstance) {
      addInstanceToPanel(selectedInstance.name, selectedInstance.img, true);

      // Guardar en localStorage
      const savedInstances = JSON.parse(localStorage.getItem("userInstances")) || [];
      savedInstances.push(selectedInstance);
      localStorage.setItem("userInstances", JSON.stringify(savedInstances));
    }
  });

  // ðŸ”¹ Crear icono en panel lateral (ahora con botÃ³n eliminar)
  function addInstanceToPanel(name, imgSrc, save = true) {
    const existingIcons = Array.from(document.querySelectorAll(".event-icon"))
      .map(icon => icon.alt.toLowerCase());
    if (existingIcons.includes(name.toLowerCase())) return;

    // Crear contenedor
    const container = document.createElement("div");
    container.style.position = "relative";
    container.style.width = "80px";
    container.style.height = "80px";
    container.style.marginBottom = "20px";
    container.classList.add("custom-instance");

    const newIcon = document.createElement("img");
    newIcon.src = imgSrc;
    newIcon.alt = name;
    newIcon.className = "event-icon";
    newIcon.title = name;

    // ðŸ”¹ BotÃ³n de eliminar
    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "ðŸ—‘";
    deleteBtn.style.position = "absolute";
    deleteBtn.style.top = "-10px";
    deleteBtn.style.right = "-10px";
    deleteBtn.style.background = "rgba(0,0,0,0.6)";
    deleteBtn.style.border = "none";
    deleteBtn.style.color = "white";
    deleteBtn.style.borderRadius = "50%";
    deleteBtn.style.cursor = "pointer";
    deleteBtn.style.fontSize = "14px";
    deleteBtn.style.padding = "3px 5px";
    deleteBtn.style.display = "none";
    deleteBtn.style.transition = "opacity 0.3s ease";

    // Mostrar botÃ³n al pasar el mouse
    container.addEventListener("mouseenter", () => (deleteBtn.style.display = "block"));
    container.addEventListener("mouseleave", () => (deleteBtn.style.display = "none"));

    // Eliminar instancia
    deleteBtn.addEventListener("click", e => {
      e.stopPropagation();
      container.remove();
      const savedInstances = JSON.parse(localStorage.getItem("userInstances")) || [];
      const updated = savedInstances.filter(inst => inst.name !== name);
      localStorage.setItem("userInstances", JSON.stringify(updated));
    });

    const addBtn = document.getElementById("addInstance");
    addBtn.parentNode.insertBefore(container, addBtn);

    container.appendChild(newIcon);
    container.appendChild(deleteBtn);

    // Al hacer clic en el icono, simular selecciÃ³n de evento
    newIcon.addEventListener("click", () => {
      alert(Evento "${name}" seleccionado âœ…);
    });

    // Guardar si es nuevo
    if (save) {
      const savedInstances = JSON.parse(localStorage.getItem("userInstances")) || [];
      savedInstances.push({ name, img: imgSrc });
      localStorage.setItem("userInstances", JSON.stringify(savedInstances));
    }
  }
</script>
</body>
</html>
