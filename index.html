<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ethernal Client 0.1</title>
  <link rel="icon" href="ðŸ”¥" />
  <script src="https://alcdn.msauth.net/browser/2.37.0/js/msal-browser.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: url('fondo-ethernal.jpg') no-repeat center center/cover;
      color: white;
      text-align: center;
      height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: background-image 0.8s ease-in-out;
      overflow: hidden;
    }

    .sidebar {
      position: absolute;
      left: 20px;
      top: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .sidebar img {
      width: 70px;
      height: 70px;
      cursor: pointer;
      border-radius: 50%;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      object-fit: cover;
    }

    .sidebar img:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px white;
    }

    #logoEvento {
      width: 360px;
      margin-bottom: 60px;
      filter: drop-shadow(0 0 8px rgba(255,255,255,0.7));
      transition: opacity 0.8s ease-in-out, transform 0.3s ease;
    }

    h1 {
      font-size: 2em;
      color: #fff;
      text-shadow: 0 0 10px #ffffff;
    }

    button {
      position: fixed;
      bottom: 100px;
      padding: 18px 80px;
      border: none;
      border-radius: 15px;
      background: rgba(0, 0, 50, 0.6);
      color: white;
      font-size: 1.3em;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      backdrop-filter: blur(5px);
    }

    button:hover {
      background: rgba(0, 0, 70, 0.9);
      transform: scale(1.05);
    }

    .fade {
      opacity: 0;
      transition: opacity 0.8s ease;
    }

    .fade.show {
      opacity: 1;
    }
  </style>
</head>
<body class="fade show">
  <div class="sidebar">
    <img src="pesadilla.png" alt="Pesadilla Hardcore" onclick="cambiarEvento('pesadilla')">
    <img src="build.png" alt="Build Ethernal Battle" onclick="cambiarEvento('build')">
    <img src="infeccion.png" alt="InfecciÃ³n Hardcore" onclick="cambiarEvento('infeccion')">
    <img src="usuario.png" alt="Usuario" id="usuarioIcono" onclick="iniciarSesion()">
  </div>

  <img id="logoEvento" class="fade show" src="logo-ethernal.png" alt="Logo principal">
  <h1 id="titulo">Ethernal Client 0.1</h1>
  <button id="playButton" onclick="entrarServidor()">JUGAR</button>

  <script>
    let ip = "na81.aternos.me";
    let puerto = "60240";
    let sesionIniciada = false;

    // ðŸŸ¦ ConfiguraciÃ³n de Microsoft Authentication (MSAL)
    const msalConfig = {
      auth: {
        clientId: "d74436bb-7b1f-4b71-ae9b-0ee145ad2b44", // CLIENTE PÃšBLICO (no cambiar)
        authority: "https://login.microsoftonline.com/consumers",
        redirectUri: window.location.origin
      }
    };

    const msalInstance = new msal.PublicClientApplication(msalConfig);

    async function iniciarSesion() {
      try {
        const loginResponse = await msalInstance.loginPopup({
          scopes: ["user.read"]
        });

        if (loginResponse) {
          sesionIniciada = true;
          const account = loginResponse.account;
          console.log("SesiÃ³n iniciada como:", account.username);

          // Obtener la foto de perfil de Microsoft
          const tokenResponse = await msalInstance.acquireTokenSilent({
            scopes: ["user.read"],
            account: account
          });

          const profile = await fetch("https://graph.microsoft.com/v1.0/me/photo/$value", {
            headers: { Authorization: `Bearer ${tokenResponse.accessToken}` }
          });

          if (profile.ok) {
            const blob = await profile.blob();
            const imageUrl = URL.createObjectURL(blob);
            document.getElementById("usuarioIcono").src = imageUrl;
          } else {
            document.getElementById("usuarioIcono").src = "usuario.png";
          }

          alert(`âœ… SesiÃ³n iniciada: ${account.username}`);
        }
      } catch (err) {
        console.error("Error en inicio de sesiÃ³n:", err);
        alert("âŒ No se pudo iniciar sesiÃ³n con Microsoft.");
      }
    }

    function cambiarEvento(evento) {
      const fondo = document.body;
      const logoEvento = document.getElementById('logoEvento');
      const titulo = document.getElementById('titulo');

      fondo.classList.remove('show');
      logoEvento.classList.remove('show');
      titulo.classList.remove('show');

      setTimeout(() => {
        if (evento === 'pesadilla') {
          fondo.style.backgroundImage = "url('fondo-pesadilla.jpg')";
          logoEvento.src = "pesadilla-logo.png";
          ip = "na81.aternos.me";
          puerto = "60240";
        } else if (evento === 'build') {
          fondo.style.backgroundImage = "url('fondo-build.jpg')";
          logoEvento.src = "build-logo.png";
          ip = "build.ethernal.me";
          puerto = "12345";
        } else if (evento === 'infeccion') {
          fondo.style.backgroundImage = "url('fondo-infeccion.jpg')";
          logoEvento.src = "infeccion-logo.png";
          ip = "infect.ethernal.me";
          puerto = "55555";
        }

        titulo.textContent = "";
        setTimeout(() => {
          fondo.classList.add('show');
          logoEvento.classList.add('show');
        }, 100);
      }, 300);
    }

    function entrarServidor() {
      if (!sesionIniciada) {
        alert("âš ï¸ Debes iniciar sesiÃ³n con tu cuenta Microsoft antes de jugar.");
        return;
      }
      const servidor = `minecraft://?addExternalServer=Ethernal Evento|${ip}:${puerto}`;
      window.location.href = servidor;
    }

    window.onload = () => {
      document.body.classList.add('fade', 'show');
      document.getElementById('logoEvento').classList.add('fade', 'show');
    };
  </script>
</body>
</html>
